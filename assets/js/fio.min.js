function escapeHTML(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function filterZones(){document.getElementById("dns-list");var e=document.getElementById("zone-search").value.toUpperCase(),t=document.getElementsByClassName("card");$("#dns-list").empty();for(var n=0;n<t.length;n++){var d=t[n],o=d.querySelector(".card-header").innerText.toUpperCase(),a=d.parentElement;if(o.indexOf(e)>-1)d.style.display="",a.style.display="",$(".fio-notif").hide();else{d.style.display="none";for(var s=!0,r=a.getElementsByClassName("card"),c=0;c<r.length;c++)if("none"!==r[c].style.display){s=!1;break}s&&(a.style.display="none")}}}function loadZones(){let e=$("#account-selector").val();$("#zone-list-items").html('\n            <div id="loading-indicator">\n                    <div class="spinner-border text-primary" role="status">\n                        <span class="visually-hidden">Loading...</span>\n                    </div>\n            </div>\n        '),$.ajax({url:"class/list-zones.php",method:"POST",data:JSON.stringify({account:e}),dataType:"json",success:function(e){$("#zone-list-items").empty(),0===e.length?$("#zone-list-items").html('<div class="text-center alert alert-warning my-3">Domain not found</div>'):(e.forEach((function(e){let t="active"===e.status?"text-success":"text-warning";$("#zone-list-items").append(`\n                    <div class="col-sm-4 mb-1">\n                        <div class="card border shadow-none rounded h-100">\n                            <div class="card-header"><b>${escapeHTML(e.name)}</b></div>\n                            <div class="card-body d-flex flex-column">\n  \t\t\t\t\t\t\t\t<p class="fio-p ${t} text-uppercase"><b>${e.status}</b></p>\n                                <ul class="mb-0">\n\t\t\t\t\t\t\t\t\t<li class="fio-p">${e.id}</li>\n                                    <li class="fio-p">${e.accname}</li>\n                                    <li class="fio-p">${e.registrar?escapeHTML(e.registrar):"not detect"}</li>\n                                    <li class="fio-p">${e.name_servers}</li>\n                                </ul>\n                            </div>\n\t\t\t\t\t\t\t    <div class="card-footer">\n                                    <button class="btn btn-primary btn-sm shadow-none fio-btn-card w-100 d-block view-dns" data-zone-id="${escapeHTML(e.id)}" data-zone-name="${escapeHTML(e.name)}">View Records</button>\n                                    <button class="btn btn-danger mt-2 btn-sm shadow-none fio-btn-card w-100 d-block delete-zone" data-zone-id="${escapeHTML(e.id)}">Delete Zone</button>\n                                </div>\n                        </div>\n                    </div>\n                    `)})),$(".delete-zone").on("click",(function(){deleteZone($(this).data("zone-id"))})))},error:function(e,t,n){console.error("Error loading zones:",t,n)}})}function loadDNSRecords(e,t){let n=$("#account-selector").val();$("#zone-name").text(t),$("#dns-list").html('\n            <tr id="loading-indicator">\n                <td colspan="7">\n                    <div class="spinner-border text-primary my-3" role="status">\n                        <span class="visually-hidden">Loading...</span>\n                    </div>\n                </td>\n            </tr>\n        '),$.ajax({url:"class/list-dns.php",method:"POST",data:JSON.stringify({zone_id:e,account:n}),contentType:"application/json",dataType:"json",success:function(t){$("#dns-list").empty(),0===t.length?$("#dns-list").html('<tr><td colspan="7"><div class="text-center alert alert-warning my-3">No DNS records found</div></td></tr>'):(t.forEach((function(t){$("#dns-list").append(`\n                            <tr>\n                                <td><input type='checkbox' name='dns-record-checkbox' value='${t.id}'></td>\n                                <td class="fio-td">${escapeHTML(t.name)}</td>\n                                <td>${escapeHTML(t.type)}</td>\n                                <td class="fio-td">${t.content}</td>\n                                <td>${escapeHTML(t.ttl)}</td>\n                                <td>\n\t\t\t\t\t\t\t \t<div class="form-check text-center">\n                                    <input type="checkbox" class="form-check-input proxied-checkbox" data-dns-record-id="${t.id}" data-zone-id="${e}" ${t.proxied?"checked":""}>\n\t\t\t\t\t\t\t\t</div>\n                                </td>\n                                <td>\n                                    <div class='d-flex'>\n                                        <button class='btn btn-outline-primary mx-1 my-1 btn-sm fio-btn-card edit-dns' data-zone-id='${escapeHTML(e)}' data-dns-record-id='${escapeHTML(t.id)}' style="padding:0px 18px 0px 18px;">Edit</button>\n                                        <button class='btn btn-outline-danger mx-1 my-1 btn-sm fio-btn-card delete-dns' data-zone-id='${escapeHTML(e)}' data-dns-record-id='${escapeHTML(t.id)}'>Delete</button>\n                                    </div>\n                                </td>\n                            </tr>`)})),window.scrollTo(0,$(".fio-height-end").offset().top))},error:function(e,t,n){$("#dns-list").html('<tr><td colspan="7" class="text-center alert alert-danger my-3">Error loading DNS records</td></tr>')}})}function deleteZone(e){let t=$("#account-selector").val();confirm("Are you sure you want to delete this zone?")&&$.ajax({url:"class/delete-zones.php",method:"POST",data:{zone_id:e,account:t},dataType:"json",success:function(e){alert(e.message||"Zone deleted successfully"),loadZones()},error:function(e,t,n){console.error("Error deleting zone:",n),alert("An error occurred while deleting the zone.")}})}function filterDNSRecords(e){const t=document.getElementById("dns-list"),n=t.getElementsByTagName("tr");for(let t=0;t<n.length;t++){const d=n[t].getElementsByTagName("td");let o=d[1]?d[1].innerText.toUpperCase():"",a=d[2]?d[2].innerText.toUpperCase():"",s=d[3]?d[3].innerText.toUpperCase():"";o.includes(e.toUpperCase())||a.includes(e.toUpperCase())||s.includes(e.toUpperCase())?n[t].style.display="":n[t].style.display="none"}let d=!1;for(let e=0;e<n.length;e++)if("none"!==n[e].style.display){d=!0;break}d||(t.innerHTML='<tr><td colspan="7"><div class="text-center alert alert-warning my-3">No DNS records found</div></td></tr>')}$(document).ready((function(){loadZones(),$(document).on("click",".view-dns",(function(){let e=$(this).data("zone-id"),t=$(this).data("zone-name");$(".add-dns").data("zone-id",e).prop("disabled",!1),$(".bulk-delete-dns").data("zone-id",e).prop("disabled",!1),$("#dns-search").prop("disabled",!1),$("#pesandns").hide(),loadDNSRecords(e,t),window.scrollTo(0,$(".fio-height-end").offset().top)})),$("#zone-search").on("input",(function(){filterZones(),$("#dns-list").empty(),$(".add-dns").prop("disabled",!0),$(".bulk-delete-dns").prop("disabled",!0),$("#dns-search").prop("disabled",!0),$("#dns-list").html('<tr><td colspan="7"><div class="text-center alert alert-warning my-3">Data is empty, please click view DNS on the domain list</div></td></tr>')})),document.getElementById("dns-search").addEventListener("input",(function(){filterDNSRecords(this.value.toUpperCase())})),$("#account-selector").on("change",(function(){loadZones(),$("#dns-list").empty(),$(".add-dns").prop("disabled",!0),$(".bulk-delete-dns").prop("disabled",!0),$("#dns-search").prop("disabled",!0),$("#dns-list").html('<tr><td colspan="7"><div class="text-center alert alert-warning my-3">Data is empty, please click view DNS on the domain list</div></td></tr>')})),$(".add-dns").click((function(){let e=$(this).data("zone-id");$("#add-zone_id").val(e),$("#addDnsModal").modal("show")})),$("#add-dns-form").submit((function(e){let t=$("#account-selector").val(),n=$("#add-zone_id").val(),d=$(this).serialize()+"&account="+t;e.preventDefault();let o=$(this).find('button[type="submit"]'),a=o.find(".spinner-border");a.removeClass("d-none"),o.prop("disabled",!0),$.ajax({url:"class/add-dns.php",method:"POST",data:d,dataType:"json",success:function(e){alert(e.message),$("#addDnsModal").modal("hide");let t=$(this).data("zone-name");loadDNSRecords(n,t)},error:function(e,t,n){console.error("Error adding DNS record:",n)},complete:function(){a.addClass("d-none"),o.prop("disabled",!1)}})})),$(document).on("click",".edit-dns",(function(){let e=$(this).data("zone-id"),t=$(this).data("dns-record-id"),n=$("#account-selector").val();$.ajax({url:"class/edit-dns.php",method:"POST",contentType:"application/x-www-form-urlencoded",data:{fetch:!0,zone_id:e,dns_record_id:t,account:n},dataType:"json",success:function(n){n.error?alert(n.error):($("#name").val(escapeHTML(n.name)),$("#type").val(escapeHTML(n.type)),$("#content").val(escapeHTML(n.content)),$("#ttl").val(escapeHTML(n.ttl)),$("#proxied").val(n.proxied?"true":"false"),$("#zone_id").val(e),$("#dns_record_id").val(t),$("#editDnsModal").modal("show"))},error:function(e,t,n){console.error("Error fetching DNS record:",n)}})})),$("#edit-dns-form").submit((function(e){e.preventDefault();let t=$("#account-selector").val(),n=$(this).serialize()+"&account="+t,d=$(this).find('button[type="submit"]'),o=d.find(".spinner-border");o.removeClass("d-none"),d.prop("disabled",!0),$.ajax({url:"class/edit-dns.php",method:"POST",data:n,dataType:"json",success:function(e){alert(e.message),$("#editDnsModal").modal("hide"),loadDNSRecords($("#zone_id").val(),$("#zone_name").val())},error:function(e,t,n){console.error("Error updating DNS record:",n)},complete:function(){o.addClass("d-none"),d.prop("disabled",!1)}})})),$(document).on("change",".proxied-checkbox",(function(){let e=$(this).data("dns-record-id"),t=$(this).data("zone-id"),n=$(this).is(":checked"),d=$("#account-selector").val();t&&e?$.ajax({url:"class/edit-dns.php",method:"POST",data:{fetch:!0,zone_id:t,dns_record_id:e,account:d},dataType:"json",success:function(o){o.error?alert(o.error):$.ajax({url:"class/edit-dns.php",method:"POST",contentType:"application/x-www-form-urlencoded",data:{update_proxied:!0,zone_id:t,dns_record_id:e,type:o.type,name:o.name,content:o.content,ttl:o.ttl,proxied:n,account:d},dataType:"json",success:function(e){alert(e.message),loadDNSRecords(t)},error:function(e,t,n){alert("Error updating proxied status.")}})},error:function(e,t,n){alert("Error fetching DNS record details.")}}):alert("Zone ID or DNS Record ID is missing or undefined.")})),$("#addZoneForm").on("submit",(function(e){e.preventDefault();let t=$("#account-selector").val(),n=$(this).serialize()+"&account="+t,d=$(this).find('button[type="submit"]'),o=d.find(".spinner-border");o.removeClass("d-none"),d.prop("disabled",!0),$.ajax({url:"class/add-zones.php",type:"POST",data:n,success:function(e){alert("Zone added successfully"),$("#addZoneModal").modal("hide"),loadZones()},error:function(){alert("Error adding zone")},complete:function(){o.addClass("d-none"),d.prop("disabled",!1)}})})),$(".bulk-delete-dns").on("click",(function(){let e=$("#account-selector").val(),t=$(this).data("zone-id"),n=$(this).data("zone-name"),d=[];$('input[name="dns-record-checkbox"]:checked').each((function(){d.push($(this).val())})),0!==d.length?confirm("Are you sure you want to delete the selected DNS records?")&&$.ajax({url:"class/delete-dns.php",type:"POST",data:{zone_id:t,dns_record_ids:d.join(","),account:e},success:function(e){let d=JSON.parse(e);alert(d.message||d.error),loadDNSRecords(t,n)},error:function(e,t,n){console.error("Error occurred:",n),alert("An error occurred while trying to delete the DNS records.")}}):alert("Please select at least one DNS record to delete.")})),$("#select-all").on("click",(function(){$('input[name="dns-record-checkbox"]').prop("checked",this.checked)})),$(document).on("click",".delete-dns",(function(e){e.preventDefault();let t=$("#account-selector").val(),n=$(this).data("zone-id"),d=$(this).data("zone-name"),o=$(this).data("dns-record-id");confirm("Are you sure you want to delete this DNS record?")&&$.ajax({url:"class/delete-dns.php",type:"POST",data:{zone_id:n,dns_record_id:o,account:t},success:function(e){let t=JSON.parse(e);alert(t.message||t.error),loadDNSRecords(n,d)},error:function(e,t,n){console.error("Error occurred:",n),alert("An error occurred while trying to delete the DNS record.")}})}))})),$(document).ready((function(){$('button[data-target="#addZoneModal"]').on("click",(function(){$("#addZoneModal").modal("show")}))}));
